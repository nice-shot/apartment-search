{% extends 'apartments/layout.html' %}
{% block content %}
<div class="row">
    <div class="col-sm-12">
        <h1>{{ title }}</h1>
        {% for post in apartment_posts %}
            <div class="panel panel-default" id={{ post.post_id }}>
                <div class="panel-heading">{{ post.user }}</div>
                <div class="panel-body">
                    <p>{{ post.message }}</p>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default post-keep">Keep</button>
                        <button type="button" class="btn btn-default post-link">Link</button>
                        <button type="button" class="btn btn-default post-remove">Remove</button>
                    </div>
                    <form class="form-inline">
                        <div class="form-group">
                            <textarea class="form-control">{{ post.comment }}</textarea>
                            <button type="button" class="btn btn-default post-comment-submit"
                             placeholder="Comment">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
$().ready(function () {
    function getBtnPost(btn) {
        return $(btn).parent().parent().parent();
    }

    function getId (btn) {
        return getBtnPost(btn).attr("id");
    }

    $(".post-link").click(function () {
        var id = getId(this);
        window.open("https://facebook.com/" + id);
    });

    var base_url = "{% url 'apartments:post' %}";

    $(".post-keep, .post-remove").click(function () {
        var id = getId(this);
        // Interet = 1 if it's a keeper and 0 if not
        var interest = +$(this).hasClass("post-keep");
        var parent = getBtnPost(this);

        $.ajax(base_url + "/" + id, {
            method: "PUT",
            data: JSON.stringify({
                "interesting": interest
            }),
            contentType: "application/json; charset=UTF-8",
            success: function () {
                console.log("Updated post: " + id);
                parent.fadeOut();
            }
        });
    });

    $(".post-comment-submit").click(function () {
        // One more parent than the other buttons
        var id = getBtnPost(this).parent().attr("id");
        var comment =  $(this).prev().val();

        $.ajax(base_url + "/" + id, {
            method: "PUT",
            data: JSON.stringify({
                "comment": comment
            }),
            contentType: "application/json; charset=UTF-8",
            success: function ()  {
                console.log("Updated post: " + id);
            }
        });

    })
});
</script>
{% endblock %}
